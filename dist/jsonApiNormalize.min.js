!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&module.exports?module.exports=b():a.jsonApiNormalize=b()}(this,function(){function a(d,e){if(!(this instanceof a)){var f=new a(d);return e?f.get(e):f}if("string"==typeof d&&(d=JSON.parse(d)),!d||!d.data)throw new Error("Invalid json api normalizer input");this.dataset=d,this.isCollection=c(d.data),this.haystack=b(d.included,this.isCollection?d.data:[d.data])}function b(a,b){var c=[],e=a||[];return d(e,function(a){c.push(a.type+"@"+a.id)}),d(b,function(a){c.indexOf(a.type+"@"+a.id)<0&&e.push(a)}),e}function c(a){return a instanceof Array}function d(a,b,d){if(c(a))for(var e=a.length,f=0;f<e;f++)b.call(d,a[f],f);else for(var g in a)a.hasOwnProperty(g)&&b.call(d,g,a[g])}function e(a,b,c){var e=[];return d(a,function(a,d){e.push(b.call(c,a,d))}),e}function f(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"==typeof b[c]&&null!==b[c]?(void 0===a[c]&&(a[c]={}),f(a[c],b[c])):a[c]=b[c]);return a}function g(b,c,e){var f={};return d(b,function(b,d){if(d)f[b]=i(b,d,c,e);else{var g=c.relationships&&c.relationships[b]&&c.relationships[b].data;if(g){var j=k(g,e);f[b]=j?new a({data:j,included:e}):void 0}else f[b]=h(b,c)}}),f}function h(a,b){return["id","type","links"].indexOf(a)>=0?b[a]:b.attributes[a]}function i(a,b,d,f){var g=d.relationships&&d.relationships[a]&&d.relationships[a].data,h=g&&k(g,f);return c(h)?e(h,function(a){return j(b,a,f)}):h?j(b,h,f):void 0}function j(b,c,d){return n.call(new a({data:c,included:d}),b)}function k(a,b){var f=[],g=c(a)?e(a,function(a){return a.type+"@"+a.id}):[a.type+"@"+a.id];return d(b,function(a){g.indexOf(a.type+"@"+a.id)>=0&&f.push(a)}),0===f.length?void 0:1!==f.length||c(a)?f:f[0]}function l(a){for(var b={},c=b,d=a.length,e=0;e<d;e++)c=c[a[e]]=c[a[e]]||(e+1===d?void 0:{});return b}function m(a){var b={};return d(a,function(a){var c=a.split(".");c.length>1?f(b,l(c)):b[a]=void 0}),b}function n(a){return this.isCollection?e(this.dataset.data,function(b){return g(a,b,this.haystack)},this):g(a,this.dataset.data,this.haystack)}return a.prototype.get=function(a){var b=n.call(this,m(c(a)?a:[a]));return this.isCollection?c(a)?b:e(b,function(b){return b[a]}):c(a)?b:b[a]},a});